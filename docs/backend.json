{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile with personal information and preferences.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "mobileNumber": {
          "type": "string",
          "description": "User's mobile phone number."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "photoUrl": {
          "type": "string",
          "description": "URL of the user's profile photo.",
          "format": "uri"
        },
        "wakeUpTime": {
          "type": "string",
          "description": "Preferred wake-up time of the user in HH:mm format."
        },
        "levelId": {
          "type": "string",
          "description": "Reference to Level. (Relationship: Level 1:N UserProfile)"
        },
        "height": {
          "type": "number",
          "description": "Height of the user."
        },
        "weight": {
          "type": "number",
          "description": "Weight of the user."
        },
        "dailyCaloriesBurned": {
          "type": "number",
          "description": "Estimated number of calories burned daily by the user."
        }
      },
      "required": [
        "id",
        "mobileNumber",
        "email",
        "wakeUpTime",
        "height",
        "weight"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task that a user needs to perform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Task entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the task."
        },
        "description": {
          "type": "string",
          "description": "Description of the task."
        },
        "type": {
          "type": "string",
          "description": "Type of the task (e.g., jogging, yoga)."
        },
        "estimatedTime": {
          "type": "number",
          "description": "Estimated time to complete the task in minutes."
        },
        "caloriesBurned": {
          "type": "number",
          "description": "Number of calories burned by completing this task."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "type",
        "estimatedTime",
        "caloriesBurned"
      ]
    },
    "UserTask": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserTask",
      "type": "object",
      "description": "Represents the assignment and completion status of a task for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserTask entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N UserTask)"
        },
        "taskId": {
          "type": "string",
          "description": "Reference to Task. (Relationship: Task 1:N UserTask)"
        },
        "completed": {
          "type": "boolean",
          "description": "Indicates whether the task has been completed by the user."
        },
        "completedAt": {
          "type": "string",
          "description": "Timestamp when the task was completed.",
          "format": "date-time"
        },
        "streakMaintained": {
          "type": "boolean",
          "description": "Indicates whether the user maintained their streak by completing this task."
        }
      },
      "required": [
        "id",
        "userId",
        "taskId",
        "completed"
      ]
    },
    "Streak": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Streak",
      "type": "object",
      "description": "Represents a user's streak for completing tasks.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Streak entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Streak)"
        },
        "startDate": {
          "type": "string",
          "description": "Date when the streak started.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "Date when the streak ended (or is currently ongoing).",
          "format": "date-time"
        },
        "score": {
          "type": "number",
          "description": "Streak score accumulated by the user."
        }
      },
      "required": [
        "id",
        "userId",
        "startDate",
        "score"
      ]
    },
    "Redemption": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Redemption",
      "type": "object",
      "description": "Represents a user's redemption of streak points for rewards.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Redemption entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Redemption)"
        },
        "redemptionDate": {
          "type": "string",
          "description": "Date when the redemption occurred.",
          "format": "date-time"
        },
        "pointsRedeemed": {
          "type": "number",
          "description": "Number of streak points redeemed."
        },
        "rewardType": {
          "type": "string",
          "description": "Type of reward redeemed (e.g., INR, gift card)."
        },
        "rewardValue": {
          "type": "number",
          "description": "Value of the reward redeemed."
        }
      },
      "required": [
        "id",
        "userId",
        "redemptionDate",
        "pointsRedeemed",
        "rewardType",
        "rewardValue"
      ]
    },
    "MealPlan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MealPlan",
      "type": "object",
      "description": "Represents a personalized meal plan for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MealPlan entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N MealPlan)"
        },
        "mealType": {
          "type": "string",
          "description": "Type of meal (e.g., breakfast, lunch, dinner)."
        },
        "foodItems": {
          "type": "string",
          "description": "Description of meal name."
        },
        "calories": {
          "type": "number",
          "description": "Number of calories in the meal."
        },
        "vitamins": {
          "type": "string",
          "description": "Vitamins present in the meal."
        },
        "minerals": {
          "type": "string",
          "description": "Minerals present in the meal."
        }
      },
      "required": [
        "id",
        "userId",
        "mealType",
        "foodItems",
        "calories"
      ]
    },
    "Level": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Level",
      "type": "object",
      "description": "Represents a user's level based on participation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Level entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the level (e.g., Beginner, Intermediate)."
        },
        "description": {
          "type": "string",
          "description": "Description of the level."
        },
        "streakThreshold": {
          "type": "number",
          "description": "Minimum streak score required to achieve this level."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "streakThreshold"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information.  Owned by the user.  The userId is the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/levels/{levelId}",
        "definition": {
          "entityName": "Level",
          "schema": {
            "$ref": "#/backend/entities/Level"
          },
          "description": "Stores level definitions. Accessible to admins.",
          "params": [
            {
              "name": "levelId",
              "description": "The unique identifier for the level."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/userTasks/{userTaskId}",
        "definition": {
          "entityName": "UserTask",
          "schema": {
            "$ref": "#/backend/entities/UserTask"
          },
          "description": "Stores user-specific task assignments and completion status. Owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "userTaskId",
              "description": "The unique identifier for the user task."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/streaks/{streakId}",
        "definition": {
          "entityName": "Streak",
          "schema": {
            "$ref": "#/backend/entities/Streak"
          },
          "description": "Stores streak data for each user. Owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "streakId",
              "description": "The unique identifier for the streak."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/redemptions/{redemptionId}",
        "definition": {
          "entityName": "Redemption",
          "schema": {
            "$ref": "#/backend/entities/Redemption"
          },
          "description": "Stores redemption records for each user. Owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "redemptionId",
              "description": "The unique identifier for the redemption."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/mealPlans/{mealPlanId}",
        "definition": {
          "entityName": "MealPlan",
          "schema": {
            "$ref": "#/backend/entities/MealPlan"
          },
          "description": "Stores meal plans for each user. Owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "mealPlanId",
              "description": "The unique identifier for the meal plan."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure authorization independence, clarity, and scalability, aligning with the core principles and strategy mandates outlined. We use path-based ownership for user-specific data and membership maps for collaborative access. The structure supports QAPs by segregating data based on access needs and employing consistent authorization patterns. Denormalization is used extensively to avoid `get()` calls in security rules, thereby enabling atomic operations.  Each user's data is stored under a unique path `/users/{userId}`, ensuring clear ownership. Redemptions, MealPlans and Streaks are also stored under the user's path, further emphasizing this ownership.  UserTasks are structured under the user, creating a clear hierarchy (`/users/{userId}/userTasks/{userTaskId}`). This structure facilitates simple and efficient security rules based on path-based ownership. Levels are stored in a root-level collection `/levels`, allowing easy querying and management of different level definitions.  The `UserTasks` collection under each user stores the completion status and other relevant information for each task assigned to the user. This ensures that all task-related data is directly associated with the user, simplifying queries and improving security.  This design supports the required QAPs (Rules Are Not Filters) by segregating data based on access needs and employing consistent authorization patterns."
  }
}